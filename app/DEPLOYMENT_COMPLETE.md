# ‚úÖ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ Backend –ó–∞–≤–µ—Ä—à–µ–Ω–æ

## üìã –°—Ç–∞—Ç—É—Å –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

### Backend API (146.103.99.70)
- ‚úÖ **peers.py –æ–±–Ω–æ–≤–ª–µ–Ω** —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –ø—É–±–ª–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞
- ‚úÖ **.env.production –∑–∞–≥—Ä—É–∂–µ–Ω –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω**
- ‚úÖ **Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–µ–Ω** –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ **API –¥–æ—Å—Ç—É–ø–µ–Ω** –Ω–∞ http://146.103.99.70:8000

### –ß—Ç–æ –±—ã–ª–æ –∏–∑–º–µ–Ω–µ–Ω–æ:

**backend_api/peers.py (—Å—Ç—Ä–æ–∫–∏ 54-60)**

–ë—ã–ª–æ (–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û):
```python
if key_policy == "db":
    if not public:
        public = f"db:{secrets.token_urlsafe(16)}"  # ‚ùå Placeholder –∫–ª—é—á!
```

–°—Ç–∞–ª–æ (–ü–†–ê–í–ò–õ–¨–ù–û):
```python
if key_policy == "db":
    if not public:
        raise HTTPException(
            status_code=400,
            detail="wg_public_key is required..."  # ‚úÖ –¢—Ä–µ–±—É–µ—Ç –≤–∞–ª–∏–¥–Ω—ã–π –∫–ª—é—á –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞
        )
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ VPN –ü–æ–¥–∫–ª—é—á–µ–Ω–∏—è

### –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ:

```
üì± Device: Samsung SM S938B (Android 16, ARM64)
üì± App: com.example.vpn.dev (deployed and running)
üì± Logs: monitoring in real-time via adb logcat
```

### –ß—Ç–æ –¥–æ–ª–∂–Ω–æ –ø—Ä–æ–∏–∑–æ–π—Ç–∏ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ VPN:

1. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–∞** (–Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ)
   - –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–æ–∑–¥–∞–µ—Ç 32-–±–∞–π—Ç–Ω—É—é –ø–∞—Ä—É WireGuard –∫–ª—é—á–µ–π
   - –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è: `[DEBUG] Generated WireGuard key pair`

2. **–°–æ–∑–¥–∞–Ω–∏–µ peer** (POST /vpn_peers/self)
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è: `{wg_public_key: "base64_valid_key", ...}`
   - –û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç: HTTP 200 —Å `VpnPeerOut` –æ–±—ä–µ–∫—Ç–æ–º

3. **–ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥–∞** (GET /vpn_peers/self/config)
   - –û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç: wg-quick —Ñ–æ—Ä–º–∞—Ç —Å –≤–∞–ª–∏–¥–Ω—ã–º–∏ –∫–ª—é—á–∞–º–∏
   - –í–∞–∂–Ω–æ: –ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º base64, –Ω–µ `db:xxx`

4. **WireGuard –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ**
   - –ö–æ–Ω—Ñ–∏–≥ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ wireguard_flutter –ø–ª–∞–≥–∏–Ω
   - –î–æ–ª–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ 62.84.98.109:51820

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞:

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–µ—Ä—Å–∏—é –∫–æ–¥–∞
ssh root@146.103.99.70 "sed -n '54,57p' /srv/vpn-api/vpn_api/peers.py"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ API
ssh root@146.103.99.70 "docker compose logs web --tail 50"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å docker
ssh root@146.103.99.70 "docker compose ps"
```

### –õ–æ–≥–∏ –∫–ª–∏–µ–Ω—Ç–∞ (Android):

–õ–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –≤ terminal —Å ID:
```
d0619c85-42c1-4c1b-a8d8-f90517b3ef26
```

–ò—â–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏—è:
- `[DEBUG] Generated WireGuard key pair` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–∞
- `[DEBUG] Creating peer with key:` - –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- `[ERROR] Failed to activate WireGuard VPN` - –æ—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

---

## üîß –°–ª–µ–¥—É—é—â–∏–µ –®–∞–≥–∏

### –ï—Å–ª–∏ VPN —Ä–∞–±–æ—Ç–∞–µ—Ç ‚úÖ
1. –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –ü–æ–ª–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ WireGuard —Å–µ—Ä–≤–µ—Ä–µ: `wg show` (–¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å –∞–∫—Ç–∏–≤–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ)
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å IP: –î–æ–ª–∂–µ–Ω –∏–∑–º–µ–Ω–∏—Ç—å—Å—è –Ω–∞ 62.84.98.109

### –ï—Å–ª–∏ VPN –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç ‚ùå
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞: `ssh root@146.103.99.70 "docker compose logs web --tail 30"`
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –≤ –æ—Ç–≤–µ—Ç–µ —Å–µ—Ä–≤–µ—Ä–∞: –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å base64, –Ω–µ `db:xxx`
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥ WireGuard: –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å `[Interface]` –∏ `[Peer]` —Å–µ–∫—Ü–∏–∏
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω–Ω–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: `curl http://146.103.99.70:8000/docs`

---

## üìù –ö–æ–º–∞–Ω–¥—ã –î–ª—è –û—Ç–ª–∞–¥–∫–∏

```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ 50 —Å—Ç—Ä–æ–∫ –ª–æ–≥–æ–≤ API
ssh root@146.103.99.70 "docker compose logs web --tail 50"

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –æ—à–∏–±–∫—É –≤ –ª–æ–≥–∞—Ö (grep)
ssh root@146.103.99.70 "docker compose logs web | grep -i 'wg_public\|error\|exception' | tail -20"

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å docker (–µ—Å–ª–∏ –Ω—É–∂–Ω–∞ –æ—á–∏—Å—Ç–∫–∞)
ssh root@146.103.99.70 "cd /srv/vpn-api && docker compose restart web"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥ WireGuard –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
ssh root@146.103.99.70 "wg show all"
```

---

## ‚ú® –ò—Ç–æ–≥–∏

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|-----------|--------|-----------|
| Backend API | ‚úÖ –†–∞–∑–≤–µ—Ä–Ω—É—Ç | peers.py —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π |
| Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | –ù–∞ 146.103.99.70:8000 |
| Flutter –∫–ª–∏–µ–Ω—Ç | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | –ù–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ Android |
| WireGuard —Å–µ—Ä–≤–µ—Ä | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | –ù–∞ 62.84.98.109:51820 |

–¢–µ–ø–µ—Ä—å –æ—Å—Ç–∞–ª–æ—Å—å **–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å VPN –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ**! üöÄ

–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É VPN –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∏ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ –ª–æ–≥–∏ –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.
