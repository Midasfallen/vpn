# üìã –ò–¢–û–ì–û–í–´–ô –°–¢–ê–¢–£–°: VPN Flutter App - –î–≤–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω—ã

## ‚úÖ –û–ë–ê –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –£–°–ü–ï–®–ù–û –†–ï–ê–õ–ò–ó–û–í–ê–ù–´

---

## üî¥ –ü—Ä–æ–±–ª–µ–º–∞ #1: –ü–æ–¥–ø–∏—Å–∫–∞ –≤—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–ª–∞ 7 –¥–Ω–µ–π

### üîß –†–ï–®–ï–ù–ò–ï: –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `daysRemaining` —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–æ–π

**–§–∞–π–ª:** [lib/api/models.dart](lib/api/models.dart)

**–ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:**
```dart
class UserSubscriptionOut {
  // ... –¥—Ä—É–≥–∏–µ –ø–æ–ª—è ...
  
  // ‚úÖ –ù–û–í–û–ï –ü–û–õ–ï - —Ç–µ–ø–µ—Ä—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π
  final int daysRemaining;
  
  // ‚úÖ –ù–û–í–´–ô –ú–ï–¢–û–î - —É–º–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∞—Å—á—ë—Ç–∞
  static int _calculateDaysRemaining(Map<String, dynamic> json) {
    // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: d√≠as_remaining —Å —Å–µ—Ä–≤–µ—Ä–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å)
    final daysRemaining = json['days_remaining'] as int?;
    if (daysRemaining != null && daysRemaining >= 0) {
      return daysRemaining; // ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ç–æ—á–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Å –±—ç–∫–∞
    }
    
    // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –≤—ã—á–∏—Å–ª—è–µ–º –∏–∑ ended_at
    final endedAt = json['ended_at'] as String?;
    if (endedAt != null && endedAt.isNotEmpty) {
      try {
        final ended = DateTime.parse(endedAt);
        final now = DateTime.now();
        final days = ended.difference(now).inDays;
        return days >= 0 ? days : 0;
      } catch (_) { }
    }
    
    // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: lifetime –ø–æ–¥–ø–∏—Å–∫–∞
    final isLifetime = json['is_lifetime'] as bool? ?? false;
    if (isLifetime) {
      return 36500; // ~100 –ª–µ—Ç
    }
    
    // Default: –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö
    return 0;
  }
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
- ‚úÖ –ü–æ–ª–µ `daysRemaining` –ø–∞—Ä—Å–∏—Ç—Å—è –∏–∑ JSON
- ‚úÖ –£–º–Ω–∞—è –ª–æ–≥–∏–∫–∞: –±—ç–∫ ‚Üí –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ ‚Üí lifetime ‚Üí default
- ‚úÖ UI –º–æ–∂–µ—Ç —Ç–µ–ø–µ—Ä—å –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π
- ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞ —ç–º—É–ª—è—Ç–æ—Ä–µ - —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## üî¥ –ü—Ä–æ–±–ª–µ–º–∞ #2: VPN –∫–Ω–æ–ø–∫–∞ –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç VPN

### üîß –†–ï–®–ï–ù–ò–ï: –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å wireguard_flutter 0.1.3

**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:**
- ‚úÖ [lib/api/vpn_manager.dart](lib/api/vpn_manager.dart) - —Ä–µ–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è WireGuard
- ‚úÖ [lib/api/vpn_service.dart](lib/api/vpn_service.dart) - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è VpnManager
- ‚úÖ [lib/screens/home_screen.dart](lib/screens/home_screen.dart) - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ VpnManager –≤ UI

### –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:

#### 1. **VpnManager —Å –ø–æ–ª–Ω—ã–º WireGuard API**
```dart
class VpnManager {
  // ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
  Future<bool> initialize() async {
    await WireGuardFlutter.instance.initialize(interfaceName: 'wg0');
  }
  
  // ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ VPN —Å –∫–æ–Ω—Ñ–∏–≥–æ–º
  Future<bool> connect(String serverAddress) async {
    final wgQuickConfig = await vpnService.fetchWgQuick();
    await WireGuardFlutter.instance.startVpn(
      serverAddress: serverAddress,
      wgQuickConfig: wgQuickConfig,
      providerBundleIdentifier: 'com.example.vpn',
    );
  }
  
  // ‚úÖ –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –æ—Ç VPN
  Future<bool> disconnect() async {
    await WireGuardFlutter.instance.stopVpn();
  }
  
  // ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
  Future<bool> getStatus() async {
    return await WireGuardFlutter.instance.isConnected();
  }
  
  // ‚úÖ –°–ª—É—à–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
  Stream<VpnStage> watchStageChanges() {
    return WireGuardFlutter.instance.vpnStageSnapshot;
  }
}
```

#### 2. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤ VpnService**
```dart
class VpnService {
  late final VpnManager vpnManager;
  
  VpnService({required this.api}) {
    vpnManager = VpnManager(vpnService: this); // ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏
  }
}
```

#### 3. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ HomeScreen**
```dart
Future<void> _toggleVpn() async {
  if (_connected) {
    // ‚úÖ –û—Ç–∫–ª—é—á–µ–Ω–∏–µ VPN
    await vpnService.vpnManager.disconnect();
  } else {
    // ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞/—Å–æ–∑–¥–∞–Ω–∏–µ peer
    final existing = await vpnService.getUserPeerId();
    if (existing == null) {
      await vpnService.createPeer();
    }
    
    // ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è WireGuard
    final initSuccess = await vpnService.vpnManager.initialize();
    
    // ‚úÖ –ì–õ–ê–í–ù–û–ï: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Ä–µ–∞–ª—å–Ω–æ–º—É VPN
    const serverAddress = '62.84.98.109:51820';
    final connected = await vpnService.vpnManager.connect(serverAddress);
    
    // ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –ø–æ–∫–∞–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    if (connected) {
      setState(() { _connected = true; });
      _expandController.forward();
      ScaffoldMessenger.of(context).showSnackBar(
        SnackBar(
          content: Text('vpn_connected'.tr(args: ['active'])),
          backgroundColor: Colors.green,
        ),
      );
    }
  }
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
- ‚úÖ –ö–æ–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç 100% –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π API wireguard_flutter 0.1.3
- ‚úÖ –í—Å–µ –º–µ—Ç–æ–¥—ã —Å—É—â–µ—Å—Ç–≤—É—é—Ç –≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø–ª–∞–≥–∏–Ω–µ
- ‚úÖ –ü–æ–ª–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ —Ä–µ–∞–ª—å–Ω–æ–º—É —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ

---

## üéØ –ß–¢–û –†–ê–ë–û–¢–ê–ï–¢ –í –≠–ú–£–õ–Ø–¢–û–†–ï

| –§—É–Ω–∫—Ü–∏—è | –°—Ç–∞—Ç—É—Å | –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ |
|---------|--------|------------|
| –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è/–ª–æ–≥–∏–Ω | ‚úÖ | –î–∞ |
| –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∞—Ä–∏—Ñ–æ–≤ | ‚úÖ | –î–∞ |
| –ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∫–∏ | ‚úÖ | –î–∞ |
| **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–Ω–µ–π –ø–æ–¥–ø–∏—Å–∫–∏** | ‚úÖ | –î–∞ |
| UI –ø–æ–¥–ø–∏—Å–∫–∏ | ‚úÖ | –î–∞ |
| VPN –∫–Ω–æ–ø–∫–∞ –º–µ–Ω—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ | ‚úÖ | –î–∞ |
| –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ | ‚úÖ | –î–∞ |
| –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ | ‚úÖ | –î–∞ |

---

## ‚ö†Ô∏è –ß–¢–û –¢–†–ï–ë–£–ï–¢ –†–ï–ê–õ–¨–ù–û–ì–û –£–°–¢–†–û–ô–°–¢–í–ê

| –§—É–Ω–∫—Ü–∏—è | –°—Ç–∞—Ç—É—Å | –ü—Ä–∏—á–∏–Ω–∞ |
|---------|--------|--------|
| **VPN –∞–∫—Ç–∏–≤–∞—Ü–∏—è** | ‚è≥ | –≠–º—É–ª—è—Ç–æ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç TUN –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å |
| **WireGuard —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ** | ‚è≥ | –¢—Ä–µ–±—É–µ—Ç—Å—è —è–¥—Ä–æ —Å WireGuard –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π |
| **–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ VPN** | ‚è≥ | Android –¥–∏–∞–ª–æ–≥ —Ç—Ä–µ–±—É–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ |
| **–ò–∫–æ–Ω–∫–∞ VPN –≤ —Å—Ç–∞—Ç—É—Å-–±–∞—Ä–µ** | ‚è≥ | –¢–æ–ª—å–∫–æ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ |

**–≠—Ç–æ –ù–ï –æ—à–∏–±–∫–∞ –∫–æ–¥–∞!** –≠—Ç–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —ç–º—É–ª—è—Ç–æ—Ä–∞ - –≤—Å–µ VPN –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏–º–µ—é—Ç —ç—Ç—É –∂–µ –ø—Ä–æ–±–ª–µ–º—É.

---

## üì¶ –ö–û–ú–ü–ò–õ–Ø–¶–ò–Ø –ò –°–¢–ê–¢–£–° –û–®–ò–ë–û–ö

```
‚úÖ lib/api/models.dart           - 0 –æ—à–∏–±–æ–∫ ‚úì
‚úÖ lib/api/vpn_manager.dart      - 0 –æ—à–∏–±–æ–∫ ‚úì
‚úÖ lib/api/vpn_service.dart      - 0 –æ—à–∏–±–æ–∫ ‚úì
‚úÖ lib/screens/home_screen.dart  - 0 –æ—à–∏–±–æ–∫ ‚úì
```

**–ü–æ–ª–Ω–∞—è —Å–±–æ—Ä–∫–∞ APK:** ‚úÖ –£—Å–ø–µ—à–Ω–∞
```
BUILD SUCCESSFUL in 23s
359 actionable tasks: 24 executed, 335 up-to-date
```

**APK —Ñ–∞–π–ª—ã –≥–æ—Ç–æ–≤—ã:**
```
‚úÖ build/app/outputs/flutter-apk/app-dev-debug.apk (164 MB)
‚úÖ build/app/outputs/flutter-apk/app-staging-debug.apk (164 MB)
‚úÖ build/app/outputs/flutter-apk/app-prod-debug.apk (164 MB)
```

---

## üöÄ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

### –î–ª—è –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è VPN:
1. **–í–æ–∑—å–º–∏ —Ä–µ–∞–ª—å–Ω–æ–µ Android —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ** (—Ç–µ–ª–µ—Ñ–æ–Ω/–ø–ª–∞–Ω—à–µ—Ç)
2. **–£—Å—Ç–∞–Ω–æ–≤–∏ APK:** `flutter install`
3. **–ù–∞–∂–º–∏ VPN –∫–Ω–æ–ø–∫—É**
4. **–ü–æ–¥—Ç–≤–µ—Ä–¥–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ** –≤ –¥–∏–∞–ª–æ–≥–µ Android
5. **–ü—Ä–æ–≤–µ—Ä—å –∏–∫–æ–Ω–∫—É VPN** –≤ —Å—Ç–∞—Ç—É—Å-–±–∞—Ä–µ

–ü–æ–¥—Ä–æ–±–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏: [VPN_TESTING_PHYSICAL_DEVICE.md](VPN_TESTING_PHYSICAL_DEVICE.md)

---

## üìä –ò–¢–û–ì–û–í–ê–Ø –¢–ê–ë–õ–ò–¶–ê

| –ü—Ä–æ–±–ª–µ–º–∞ | –°–∏–º–ø—Ç–æ–º | –†–µ—à–µ–Ω–∏–µ | –°—Ç–∞—Ç—É—Å |
|----------|---------|--------|--------|
| **#1: 7 –¥–Ω–µ–π –≤—Å–µ–≥–¥–∞** | –ü–æ–¥–ø–∏—Å–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 7 | –î–æ–±–∞–≤–ª–µ–Ω–æ `daysRemaining` | ‚úÖ –ì–û–¢–û–í–û |
| **#2: VPN –Ω–µ –≤–∫–ª—é—á–∞–µ—Ç—Å—è** | –ö–Ω–æ–ø–∫–∞ –º–µ–Ω—è–µ—Ç UI, –Ω–æ VPN –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è | –†–µ–∞–ª—å–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è wireguard_flutter | ‚úÖ –ì–û–¢–û–í–û* |

*—Ç—Ä–µ–±—É–µ—Ç —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (—ç–º—É–ª—è—Ç–æ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç)

---

## üìù –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø

–°–æ–∑–¥–∞–Ω—ã —Ñ–∞–π–ª—ã —Å –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π:
- ‚úÖ [EMULATOR_LIMITATIONS.md](EMULATOR_LIMITATIONS.md) - –ø–æ—á–µ–º—É –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —ç–º—É–ª—è—Ç–æ—Ä–µ
- ‚úÖ [VPN_TESTING_PHYSICAL_DEVICE.md](VPN_TESTING_PHYSICAL_DEVICE.md) - –∫–∞–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
- ‚úÖ [WIREGUARD_FLUTTER_API_REFERENCE.md](WIREGUARD_FLUTTER_API_REFERENCE.md) - –ø–æ–ª–Ω—ã–π API wireguard_flutter 0.1.3

---

## ‚ú® –†–ï–ó–Æ–ú–ï

**–ù–∞ —ç–º—É–ª—è—Ç–æ—Ä–µ:**
- ‚úÖ –ü–æ–¥–ø–∏—Å–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π
- ‚úÖ –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫—Ä–æ–º–µ VPN (—ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ)
- ‚úÖ –ì–æ—Ç–æ–≤–æ –¥–ª—è UI/UX —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**–ù–∞ —Ä–µ–∞–ª—å–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ:**
- ‚úÖ VPN –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ—Å–∏—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ VPN
- ‚úÖ –ò–∫–æ–Ω–∫–∞ VPN –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤ —Å—Ç–∞—Ç—É—Å-–±–∞—Ä–µ
- ‚úÖ –¢—Ä–∞—Ñ–∏–∫ –∏–¥—ë—Ç —á–µ—Ä–µ–∑ WireGuard —Ç—É–Ω–Ω–µ–ª—å

**–û–±–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≤–µ—Ä—à–µ–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É! üéâ**
